#9장 페브릭을 이용한 배포 자동화
python3에서 사용하고 싶어서 fabric -> fabric3를 이용함.  
aws ec2  
DNS로 cloudflare를 이용.  

페브릭(Fabric)은 서버에서 명령어를 자동으로 실행할 수 있게 해주는 툴이다.  
페브릭은 사이트의 중요 기능이 아니기 때문에 로컬 PC에 설치한다.  
페브릭 코드는 기존에 작업한 코드와 완전히 분리된다.  

일반적인 설정은 fabric.py라는 파일을 이용한다.  
```
fab function_name,host=SERVER_ADDRESS
```

## 배포를 위한 페브릭 스크립트 파헤치기

## 자동화 스크립트 실행해보기
죽어라 스크립트 실행이 안됬었는데... 모든게 ssh...  
역시 인프라공부는 필수라는 걸 다시 한 번 느꼈다.  

`fab deploy -i "~/.ssh/pando.pem". -H ubuntu@ec2-52-78-104-14.ap-northeast-2.compute.amazonaws.com`

ssh key를 안 넣어주는 바보같은 실수를 했다.  

`pando@unripers.com`에서  
1) 내가 만들어준 User인 pando는 결국 해결하지 못했지만,  
2) 내가 지정해둔 unripers.com에서는 cloudflare에서 제공한 proxy??등의 문제였다.  
인프라쪽에 대한 공부를 안해서 개념이 없지만 지금 생각나는 건 cloudflare가 ssh 접속시에 unripers.com에서 aws의 주소를 주지않고 cloudflare 관련 주소를 보내줘서 결국 접근을 못하는 것 같다. 이 부분은 인프라개념을 공부하고 다시 알아봐야겠다.  
cloudflare 쓰시는 분은.. 주황색을 없애주세요.  

## 배포용 Git 태그

## 추가 정보

#### 배포 자동화
페브릭(Fabric)  
페브릭은 파이썬 스크립트를 이용해서 서버상에서 명령어를 실행하게 해준다. 서버 관리 자동화를 위한 훌륭한 툴이다.  
멱등성(Idempotency)  
기존 서버에 배포 스크립트를 실행한다면, 스크립느 설계 시 두 가지 측면을 고려해야하 한다. 1) 서버에 신규로 설치하는 경우와 2) 이미 설치 버전이 있는 경우다.  
설정 파일 버전 관리  
설정 파일이 서버에만 존재하는 일은 없어야 한다. 애플리케이션 핵심 파일이기 때문에 다른 코드와 같이 버전 관리해야 한다.  
프로비저닝 자동화  
신규 서버 가동과 필요 소프트웨어 설치까지 모두 자동화돼야 한다. 또한 호스팅 제공자의 API 연계성도 확인해야 한다.  